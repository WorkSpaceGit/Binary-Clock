<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Binary Clock</title>
  <style>
    :root {
      --bit-size: 40px; /* динамічно змінюється через JS */
      --gap: calc(var(--bit-size) / 4);
    }

    body {
      background: #191919;
      color: #0f0;
      font-family: sans-serif;
      margin: 0;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { 
      color: #0f0; 
      margin-bottom: calc(var(--gap) * 2);
      font-size: calc(var(--bit-size) * 0.8);
    }
    .clock {
      display: flex;
      gap: calc(var(--gap) * 2);
      align-items: flex-end;
    }
    .digit-column {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      gap: var(--gap);
      align-items: center;
    }
    .bit {
      width: var(--bit-size);
      height: var(--bit-size);
      background: #222;
      border: calc(var(--bit-size) * 0.05) solid #333;
      border-radius: 15%;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .on {
      background: #0f0;
      box-shadow: 0 0 calc(var(--bit-size) * 0.3) #0f0;
    }
    .spacer { 
      width: var(--bit-size); 
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="clock" id="c"></div>
  </div>

  <script>
    // --- favicon (один раз, статичний) ---
    (function setFavicon() {
      const canvas = document.createElement('canvas');
      canvas.width = 64; 
      canvas.height = 64;
      const ctx = canvas.getContext('2d');
      ctx.font = "48px monospace";
      ctx.fillStyle = "#0f0";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("∞", 32, 32);

      const link = document.createElement('link');
      link.rel = 'icon';
      link.href = canvas.toDataURL('image/png');
      document.head.appendChild(link);
    })();

    // --- побудова годинника ---
    const bitLengths = [2, 4, 3, 4, 3, 4];
    const c = document.getElementById('c');
    const bitRefs = [];
    const bitState = []; // кеш стану

    bitLengths.forEach((n, i) => {
      const col = document.createElement('div');
      col.className = 'digit-column';
      const bits = [];
      const state = [];
      for (let j = 0; j < n; j++) {
        const b = document.createElement('div');
        b.className = 'bit';
        col.appendChild(b);
        bits.push(b);
        state.push(false); // початково всі off
      }
      c.appendChild(col);
      bitRefs[i] = bits;
      bitState[i] = state;

      if (i === 1 || i === 3) {
        const spacer = document.createElement('div');
        spacer.className = 'spacer';
        c.appendChild(spacer);
      }
    });

    // --- оновлення годинника ---
    function updateClock() {
      const now = new Date();
      const digits = [
        Math.floor(now.getHours() / 10), now.getHours() % 10,
        Math.floor(now.getMinutes() / 10), now.getMinutes() % 10,
        Math.floor(now.getSeconds() / 10), now.getSeconds() % 10
      ];

      digits.forEach((d, i) => {
        const bin = d.toString(2).padStart(bitLengths[i], '0');
        for (let j = 0; j < bitLengths[i]; j++) {
          const isOn = bin[j] === '1';
          if (bitState[i][j] !== isOn) {
            bitState[i][j] = isOn;
            bitRefs[i][j].classList.toggle('on', isOn);
          }
        }
      });

      // синхронізація з реальною секундою
      const delay = 1000 - (Date.now() % 1000);
      setTimeout(updateClock, delay);
    }

    // --- динамічний розмір (debounce) ---
    let resizeTimer;
    function resizeClock() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        const vw = window.innerWidth;
        const vh = window.innerHeight;
        const size = Math.min(vw / 15, vh / 10);
        document.documentElement.style.setProperty('--bit-size', `${size}px`);
      }, 100);
    }

    window.addEventListener('resize', resizeClock);
    resizeClock();

    // старт
    updateClock();
  </script>
</body>
</html>
